# Ğ Ğ°Ğ·Ğ´ĞµĞ» Activity Templates (/activity-templates)

## ĞĞ±Ñ‰ĞµĞµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ

Activity Templates â€” Ñ€Ğ°Ğ·Ğ´ĞµĞ» Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¼Ğ¸ Ğ¿Ñ€ĞµÑĞµÑ‚Ğ°Ğ¼Ğ¸ (Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ°Ğ¼Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ĞµĞ¹). Ğ—Ğ´ĞµÑÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¼Ğ¾Ğ¶ĞµÑ‚:
- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾Ğ±ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ±Ğ¾Ñ€Ñ‹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ĞµĞ¹ Ğ¸Ğ· ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ²
- ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ğµ (ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾, ĞµĞ¶ĞµĞ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¾, ĞµĞ¶ĞµĞ¼ĞµÑÑÑ‡Ğ½Ğ¾)
- ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ/Ğ´ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€ĞµÑĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ² ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ
- ĞÑ€Ñ…Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€ĞµÑĞµÑ‚Ñ‹

---

## Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

```
src/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ ActivityTemplates.tsx            # Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° (1250+ ÑÑ‚Ñ€Ğ¾Ğº)
â”œâ”€â”€ types/
â”‚   â””â”€â”€ preset.ts                        # Ğ¢Ğ¸Ğ¿Ñ‹ Ğ¿Ñ€ĞµÑĞµÑ‚Ğ¾Ğ²
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ recurrenceUtils.ts               # Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ñ
â”‚   â””â”€â”€ timeSlots.ts                     # Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ ÑĞ»Ğ¾Ñ‚Ñ‹
```

---

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ACTIVITY TEMPLATES PAGE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     TEMPLATES PALETTE        â”‚         PRESET EDITOR                â”‚
â”‚     (Ğ›ĞµĞ²Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ)           â”‚         (ĞŸÑ€Ğ°Ğ²Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ)              â”‚
â”‚                              â”‚                                      â”‚
â”‚  [ĞŸĞ¾Ğ¸ÑĞº ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ²...]         â”‚  ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ: [ĞœĞ¾Ñ Ñ€ÑƒÑ‚Ğ¸Ğ½Ğ° ÑƒÑ‚Ñ€Ğ°    ]     â”‚
â”‚                              â”‚                                      â”‚
â”‚  Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ñƒ:             â”‚  Ğ¢ĞµĞ³Ğ¸: [ğŸ”„ routine] [ğŸ’ care]        â”‚
â”‚  [Ğ’ÑĞµ][Ğ’Ğ¾ÑÑÑ‚.][Ğ˜ÑÑ‚Ğ¾Ñ‰.]       â”‚                                      â”‚
â”‚                              â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  ğŸŒ… Ğ ĞĞĞĞ•Ğ• Ğ£Ğ¢Ğ Ğ (5:00-9:00)          â”‚
â”‚  â”‚ ğŸ§˜ ĞœĞµĞ´Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ñ    [drag] â”‚  â”‚    â”œâ”€â”€ ğŸ§˜ ĞœĞµĞ´Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ñ (30 Ğ¼Ğ¸Ğ½)         â”‚
â”‚  â”‚ ğŸƒ Ğ‘ĞµĞ³          [drag] â”‚  â”‚    â””â”€â”€ ğŸƒ Ğ‘ĞµĞ³ (45 Ğ¼Ğ¸Ğ½)               â”‚
â”‚  â”‚ ğŸ“š Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ       [drag] â”‚  â”‚                                      â”‚
â”‚  â”‚ ğŸµ ĞœÑƒĞ·Ñ‹ĞºĞ°       [drag] â”‚  â”‚  â˜• ĞŸĞĞ—Ğ”ĞĞ•Ğ• Ğ£Ğ¢Ğ Ğ (9:00-12:00)        â”‚
â”‚  â”‚ ...                    â”‚  â”‚    â””â”€â”€ ğŸ“š Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ (30 Ğ¼Ğ¸Ğ½)            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                      â”‚
â”‚                              â”‚  [ğŸ—‘ï¸ ĞŸĞµÑ€ĞµÑ‚Ğ°Ñ‰Ğ¸Ñ‚Ğµ ÑÑĞ´Ğ° Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ]   â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                              â”‚  ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ğµ: [Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾ â–¼] [7 Ğ´Ğ½ĞµĞ¹]  â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â”‚  [ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ] [ğŸ—‘ï¸ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        MY PRESETS LIBRARY                           â”‚
â”‚  [ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ] [ĞÑ€Ñ…Ğ¸Ğ²]                        Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€: [Ğ’ÑĞµ Ñ‚ĞµĞ³Ğ¸ â–¼]     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ ğŸ”„ Ğ£Ñ‚Ñ€ĞµĞ½Ğ½ÑÑ     â”‚ â”‚ ğŸ§˜ ĞĞ½Ñ‚Ğ¸-ÑÑ‚Ñ€ĞµÑÑ  â”‚ â”‚ ğŸ“š ĞĞ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ     â”‚        â”‚
â”‚  â”‚    Ñ€ÑƒÑ‚Ğ¸Ğ½Ğ°       â”‚ â”‚                 â”‚ â”‚                 â”‚        â”‚
â”‚  â”‚ âœ… ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½      â”‚ â”‚ â¸ï¸ ĞĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½    â”‚ â”‚ â¸ï¸ ĞĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½    â”‚        â”‚
â”‚  â”‚ [â–¶ï¸][âœï¸][ğŸ“¦]    â”‚ â”‚ [â–¶ï¸][âœï¸][ğŸ“¦]    â”‚ â”‚ [â–¶ï¸][âœï¸][ğŸ“¦]    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ĞœĞ¾Ğ´ĞµĞ»Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### UserPreset (ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¹ Ğ¿Ñ€ĞµÑĞµÑ‚)

```typescript
interface UserPreset {
  id: string;
  user_id: string;
  name: string;
  emoji: string;
  activities: PresetActivity[];
  tags: PresetTag[];
  
  // ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ñ
  recurrence_type: 'none' | 'daily' | 'weekly' | 'monthly' | 'custom';
  recurrence_count: number;
  custom_interval?: number;
  custom_unit?: 'day' | 'week' | 'month';
  custom_end_type?: 'never' | 'date' | 'count';
  custom_end_date?: string;
  custom_end_count?: number;
  
  // Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸
  is_active: boolean;
  is_archived: boolean;
  activation_start_date?: string;
  activation_end_date?: string;
  last_activated_at?: string;
  
  created_at: string;
  updated_at: string;
}
```

### PresetActivity (ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğ² Ğ¿Ñ€ĞµÑĞµÑ‚Ğµ)

```typescript
interface PresetActivity {
  template_id: string;           // ID ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ°
  category: string;              // ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸
  day_part: DayPart;             // Ğ§Ğ°ÑÑ‚ÑŒ Ğ´Ğ½Ñ
  duration: number;              // Ğ”Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ² Ğ¼Ğ¸Ğ½ÑƒÑ‚Ğ°Ñ…
  repetitions: number;           // ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ğ¹
}

type DayPart = 
  | 'early_morning'   // 5:00-9:00
  | 'late_morning'    // 9:00-12:00
  | 'midday'          // 12:00-14:00
  | 'afternoon'       // 14:00-17:00
  | 'evening'         // 17:00-21:00
  | 'night';          // 21:00-5:00
```

### PresetTag (Ğ¢ĞµĞ³Ğ¸ Ğ¿Ñ€ĞµÑĞµÑ‚Ğ¾Ğ²)

```typescript
type PresetTag = 
  | 'routine'       // ğŸ”„ Ğ ÑƒÑ‚Ğ¸Ğ½Ğ°
  | 'care'          // ğŸ’ Ğ—Ğ°Ğ±Ğ¾Ñ‚Ğ°
  | 'health'        // ğŸ¥ Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ
  | 'sport'         // ğŸƒ Ğ¡Ğ¿Ğ¾Ñ€Ñ‚
  | 'habits'        // âœ… ĞŸÑ€Ğ¸Ğ²Ñ‹Ñ‡ĞºĞ¸
  | 'tasks'         // ğŸ“‹ Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸
  | 'rest'          // ğŸ˜´ ĞÑ‚Ğ´Ñ‹Ñ…
  | 'learning'      // ğŸ“š ĞĞ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ
  | 'development'   // ğŸŒ± Ğ Ğ°Ğ·Ğ²Ğ¸Ñ‚Ğ¸Ğµ
  | 'antistress'    // ğŸ§˜ ĞĞ½Ñ‚Ğ¸ÑÑ‚Ñ€ĞµÑÑ
  | 'basic_needs'   // ğŸ  Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ½Ğ¾ÑÑ‚Ğ¸
  | 'other';        // ğŸ“Œ Ğ”Ñ€ÑƒĞ³Ğ¾Ğµ

const TAG_EMOJIS: Record<PresetTag, string> = {
  routine: 'ğŸ”„',
  care: 'ğŸ’',
  health: 'ğŸ¥',
  sport: 'ğŸƒ',
  habits: 'âœ…',
  tasks: 'ğŸ“‹',
  rest: 'ğŸ˜´',
  learning: 'ğŸ“š',
  development: 'ğŸŒ±',
  antistress: 'ğŸ§˜',
  basic_needs: 'ğŸ ',
  other: 'ğŸ“Œ',
};
```

---

## Ğ§Ğ°ÑÑ‚Ğ¸ Ğ´Ğ½Ñ (Day Parts)

```typescript
const DAY_PARTS = [
  { value: 'early_morning', labelKey: 'calendar.dayParts.earlyMorning', emoji: 'ğŸŒ…' },
  { value: 'late_morning', labelKey: 'calendar.dayParts.lateMorning', emoji: 'â˜•' },
  { value: 'midday', labelKey: 'calendar.dayParts.midday', emoji: 'â˜€ï¸' },
  { value: 'afternoon', labelKey: 'calendar.dayParts.afternoon', emoji: 'ğŸŒ¤ï¸' },
  { value: 'evening', labelKey: 'calendar.dayParts.evening', emoji: 'ğŸŒ†' },
  { value: 'night', labelKey: 'calendar.dayParts.night', emoji: 'ğŸŒ™' },
];
```

---

## Ğ¢Ğ¸Ğ¿Ñ‹ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ñ

```typescript
const RECURRENCE_TYPES = [
  { value: 'none', labelKey: 'calendar.form.recurrence.none' },     // Ğ‘ĞµĞ· Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ñ
  { value: 'daily', labelKey: 'calendar.form.recurrence.daily' },   // Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾
  { value: 'weekly', labelKey: 'calendar.form.recurrence.weekly' }, // Ğ•Ğ¶ĞµĞ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¾
  { value: 'monthly', labelKey: 'calendar.form.recurrence.monthly' }, // Ğ•Ğ¶ĞµĞ¼ĞµÑÑÑ‡Ğ½Ğ¾
  { value: 'custom', labelKey: 'calendar.form.recurrence.custom' }, // ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğµ
];
```

---

## Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Drag & Drop

### ĞŸĞµÑ€ĞµÑ‚Ğ°ÑĞºĞ¸Ğ²Ğ°Ğ½Ğ¸Ğµ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ° â†’ Ñ‡Ğ°ÑÑ‚ÑŒ Ğ´Ğ½Ñ

```typescript
const handleTemplateDragStart = (e: DragEvent, template: ActivityTemplate) => {
  setDraggedTemplate(template);
  setDraggedActivityIndex(null);
  e.dataTransfer.effectAllowed = 'copy';
};

const handleDayPartDrop = (e: DragEvent, dayPartValue: string) => {
  if (draggedTemplate) {
    const newActivity: PresetActivity = {
      template_id: draggedTemplate.id,
      category: draggedTemplate.category,
      day_part: dayPartValue,
      duration: draggedTemplate.default_duration_minutes || 30,
      repetitions: 1,
    };
    setActivities([...activities, newActivity]);
  }
};
```

### ĞŸĞµÑ€ĞµÑ‚Ğ°ÑĞºĞ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ‡Ğ°ÑÑ‚ÑĞ¼Ğ¸ Ğ´Ğ½Ñ

```typescript
const handleActivityDragStart = (e: DragEvent, index: number) => {
  setDraggedActivityIndex(index);
  setDraggedTemplate(null);
  e.dataTransfer.effectAllowed = 'move';
};

const handleDayPartDrop = (e: DragEvent, dayPartValue: string) => {
  if (draggedActivityIndex !== null) {
    const updatedActivities = [...activities];
    updatedActivities[draggedActivityIndex] = {
      ...updatedActivities[draggedActivityIndex],
      day_part: dayPartValue
    };
    setActivities(updatedActivities);
  }
};
```

### ĞŸĞµÑ€ĞµÑ‚Ğ°ÑĞºĞ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² Ğ·Ğ¾Ğ½Ñƒ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ

```typescript
const handleRemoveZoneDrop = (e: DragEvent) => {
  if (draggedActivityIndex !== null) {
    removeActivity(draggedActivityIndex);
  }
};
```

---

## Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¿Ñ€ĞµÑĞµÑ‚Ğ°

```typescript
const saveMutation = useMutation({
  mutationFn: async () => {
    const presetData = { 
      name: name.trim(), 
      emoji: TAG_EMOJIS[selectedTags[0]] || 'ğŸ“‹', 
      activities: JSON.parse(JSON.stringify(activities)),
      tags: selectedTags,
      recurrence_type: recurrenceType,
      recurrence_count: recurrenceCount,
      custom_interval: customInterval,
      custom_unit: customUnit,
      custom_end_type: customEndType,
      custom_end_date: format(customEndDate, 'yyyy-MM-dd'),
      custom_end_count: customEndCount,
    };

    if (editingPreset?.id) {
      // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾
      await supabase
        .from('user_presets')
        .update(presetData)
        .eq('id', editingPreset.id);
    } else {
      // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾
      await supabase
        .from('user_presets')
        .insert([{ user_id: user.id, ...presetData }]);
    }
  },
  onSuccess: () => {
    queryClient.invalidateQueries({ queryKey: ['user-presets'] });
    clearEditor();
  },
});
```

---

## Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ñ€ĞµÑĞµÑ‚Ğ°

ĞŸÑ€Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ñ€ĞµÑĞµÑ‚Ğ° ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ÑÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ² ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ğµ:

```typescript
const activateMutation = useMutation({
  mutationFn: async (preset: UserPreset) => {
    const startDate = new Date();
    
    // 1. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ñ‚ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ñ
    const recurrenceDates = generateRecurrenceDates(startDate, {
      recurrence_type: preset.recurrence_type,
      recurrence_count: preset.recurrence_count,
      custom_interval: preset.custom_interval,
      custom_unit: preset.custom_unit,
      custom_end_type: preset.custom_end_type,
      custom_end_date: preset.custom_end_date,
      custom_end_count: preset.custom_end_count,
    });

    // 2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ĞµĞ¹ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ´Ğ°Ñ‚Ñ‹
    const activitiesToCreate = [];
    for (const dateStr of recurrenceDates) {
      for (const activity of preset.activities) {
        const template = templates.find(t => t.id === activity.template_id);
        if (!template) continue;

        activitiesToCreate.push({
          user_id: user.id,
          user_preset_id: preset.id,
          title: getLocalizedName(template),
          category: activity.category,
          impact_type: template.impact_type,
          duration_minutes: activity.duration,
          status: 'planned',
          emoji: template.emoji,
          date: dateStr,
          start_time: getDefaultTimeForSlot(activity.day_part),
        });
      }
    }

    // 3. Batch insert (Ğ¿Ğ¾ 100 Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹)
    for (let i = 0; i < activitiesToCreate.length; i += 100) {
      const batch = activitiesToCreate.slice(i, i + 100);
      await supabase.from('activities').insert(batch);
    }

    // 4. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ¿Ñ€ĞµÑĞµÑ‚Ğ°
    await supabase
      .from('user_presets')
      .update({
        is_active: true,
        last_activated_at: new Date().toISOString(),
        activation_start_date: format(startDate, 'yyyy-MM-dd'),
        activation_end_date: calculateActivationEndDate(startDate, recurrenceSettings),
      })
      .eq('id', preset.id);

    return activitiesToCreate.length;
  },
});
```

---

## Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ´ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ñ€ĞµÑĞµÑ‚Ğ°

ĞŸÑ€Ğ¸ Ğ´ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ ÑƒĞ´Ğ°Ğ»ÑÑÑ‚ÑÑ Ğ²ÑĞµ ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸:

```typescript
const deactivateMutation = useMutation({
  mutationFn: async (presetId: string) => {
    // 1. Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸, ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ÑÑ‚Ğ¸Ğ¼ Ğ¿Ñ€ĞµÑĞµÑ‚Ğ¾Ğ¼
    await supabase
      .from('activities')
      .delete()
      .eq('user_preset_id', presetId);

    // 2. ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ñ€ĞµÑĞµÑ‚Ğ°
    await supabase
      .from('user_presets')
      .update({
        is_active: false,
        activation_start_date: null,
        activation_end_date: null,
      })
      .eq('id', presetId);
  },
});
```

---

## ĞÑ€Ñ…Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ

### ĞÑ€Ñ…Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ (soft delete)

```typescript
const archiveMutation = useMutation({
  mutationFn: async (presetId: string) => {
    // 1. Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸
    await supabase.from('activities').delete().eq('user_preset_id', presetId);

    // 2. ĞŸĞ¾Ğ¼ĞµÑ‚Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ½Ñ‹Ğ¹
    await supabase
      .from('user_presets')
      .update({ 
        is_archived: true, 
        is_active: false,
        activation_start_date: null,
        activation_end_date: null 
      })
      .eq('id', presetId);
  },
});
```

### Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ°

```typescript
const restoreMutation = useMutation({
  mutationFn: async (presetId: string) => {
    await supabase
      .from('user_presets')
      .update({ is_archived: false })
      .eq('id', presetId);
  },
});
```

### ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ

```typescript
const deleteMutation = useMutation({
  mutationFn: async (presetId: string) => {
    // 1. Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸
    await supabase.from('activities').delete().eq('user_preset_id', presetId);
    
    // 2. Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑĞ°Ğ¼ Ğ¿Ñ€ĞµÑĞµÑ‚
    await supabase.from('user_presets').delete().eq('id', presetId);
  },
});
```

---

## Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸

```typescript
// Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑÑƒ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ°
const activePresets = userPresets.filter(p => !p.is_archived);
const archivedPresets = userPresets.filter(p => p.is_archived);

// Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ñ‚ĞµĞ³Ğ°Ğ¼
const filteredActivePresets = libraryTagFilter === 'all' 
  ? activePresets 
  : activePresets.filter(p => p.tags?.includes(libraryTagFilter));
```

---

## Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ñ

### generateRecurrenceDates

```typescript
// src/utils/recurrenceUtils.ts
export function generateRecurrenceDates(
  startDate: Date, 
  settings: RecurrenceSettings
): string[] {
  const dates: string[] = [];
  let currentDate = new Date(startDate);
  let count = 0;

  switch (settings.recurrence_type) {
    case 'daily':
      while (count < settings.recurrence_count) {
        dates.push(format(currentDate, 'yyyy-MM-dd'));
        currentDate = addDays(currentDate, 1);
        count++;
      }
      break;
      
    case 'weekly':
      while (count < settings.recurrence_count) {
        dates.push(format(currentDate, 'yyyy-MM-dd'));
        currentDate = addWeeks(currentDate, 1);
        count++;
      }
      break;
      
    case 'monthly':
      while (count < settings.recurrence_count) {
        dates.push(format(currentDate, 'yyyy-MM-dd'));
        currentDate = addMonths(currentDate, 1);
        count++;
      }
      break;
      
    case 'custom':
      // Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ñ
      break;
  }

  return dates;
}
```

---

## Ğ›Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ¼Ñ‘Ğ½ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ²

```typescript
const getLocalizedName = (template: ActivityTemplate): string => {
  switch (locale) {
    case 'ru':
      return template.name_ru || template.name_en;
    case 'fr':
      return template.name_fr;
    default:
      return template.name_en;
  }
};
```
