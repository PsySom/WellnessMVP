# –†–∞–∑–¥–µ–ª Recommendations (/recommendations)

## –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

Recommendations ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å–∏ —Ç—Ä–µ–∫–µ—Ä–æ–≤ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —É–ª—É—á—à–∏—Ç—å —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îî‚îÄ‚îÄ Recommendations.tsx              # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îú‚îÄ‚îÄ supabase/functions/
‚îÇ   ‚îî‚îÄ‚îÄ generate-recommendations/
‚îÇ       ‚îî‚îÄ‚îÄ index.ts                     # Edge function –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏                                   [üîÑ –û–±–Ω–æ–≤–∏—Ç—å]‚îÇ
‚îÇ  –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è –≤–∞—Å                                            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –≤—ã—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø—Ä–∏–Ω—è—Ç—å –º–µ—Ä—ã.                                   ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  üî¥ HIGH PRIORITY                                                ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ üßò                                                     [‚úï]  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ [High] [High stress]                                        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ –ú–µ–¥–∏—Ç–∞—Ü–∏—è –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏                                      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ –ü—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è —Å—Ç—Ä–µ—Å—Å–∞ –∏ —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ meditation ‚Ä¢ 15 min ‚Ä¢ restoring                             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ [+ –î–æ–±–∞–≤–∏—Ç—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è] [üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å]                  ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  üü° MEDIUM PRIORITY                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ üö∂                                                     [‚úï]  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ [Medium] [Low energy]                                       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ –ü—Ä–æ–≥—É–ª–∫–∞ –Ω–∞ —Å–≤–µ–∂–µ–º –≤–æ–∑–¥—É—Ö–µ                                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ –õ—ë–≥–∫–∞—è —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ walks ‚Ä¢ 30 min ‚Ä¢ restoring                                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ [+ –î–æ–±–∞–≤–∏—Ç—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è] [üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å]                  ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  üí≠ SUGGESTIONS                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ üìö                                                     [‚úï]  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ [Low] [Balance]                                             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ –ß—Ç–µ–Ω–∏–µ                                                      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ –†–∞—Å—Å–ª–∞–±–ª—è—é—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞                           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ reading ‚Ä¢ 30 min ‚Ä¢ restoring                                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ [+ –î–æ–±–∞–≤–∏—Ç—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è] [üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å]                  ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

### Recommendation

```typescript
interface Recommendation {
  id: string;
  user_id: string;
  activity_template_id: string;
  reason: string;                    // –ü—Ä–∏—á–∏–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
  priority: number;                  // 1 = –≤—ã—Å–æ–∫–∏–π, 2 = —Å—Ä–µ–¥–Ω–∏–π, 3+ = –Ω–∏–∑–∫–∏–π
  accepted: boolean | null;          // true = –ø—Ä–∏–Ω—è—Ç–æ, false = –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ
  dismissed: boolean;                // –û—Ç–∫–ª–æ–Ω–µ–Ω–æ –±–µ–∑ –¥–µ–π—Å—Ç–≤–∏—è
  expires_at: string | null;         // –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
  created_at: string;
  
  // Join —Å activity_templates
  activity_templates: {
    name: string;
    emoji: string;
    category: string;
    impact_type: string;
    default_duration_minutes: number;
    description: string;
  };
}
```

### –¢–∞–±–ª–∏—Ü–∞ user_recommendations

```sql
CREATE TABLE user_recommendations (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES auth.users,
  activity_template_id UUID REFERENCES activity_templates,
  reason TEXT,                       -- 'High stress', 'Low energy', etc.
  priority INTEGER DEFAULT 3,        -- 1 = high, 2 = medium, 3+ = low
  accepted BOOLEAN,                  -- NULL = pending, TRUE/FALSE = decided
  dismissed BOOLEAN DEFAULT FALSE,
  expires_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT now()
);
```

### –¢–∞–±–ª–∏—Ü–∞ recommendation_rules

```sql
CREATE TABLE recommendation_rules (
  id UUID PRIMARY KEY,
  trigger_condition JSONB,           -- –£—Å–ª–æ–≤–∏–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è
  activity_template_ids UUID[],      -- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —à–∞–±–ª–æ–Ω—ã
  priority INTEGER DEFAULT 3,
  enabled BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMPTZ
);

-- –ü—Ä–∏–º–µ—Ä trigger_condition:
-- { "stress_level": { "gte": 7 } }
-- { "mood_score": { "lte": -2 } }
-- { "energy_level": { "lte": -3 } }
```

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

| Priority | Label | Badge Color | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------|-------------|----------|
| 1 | High | `bg-destructive` | –°—Ä–æ—á–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–≤—ã—Å–æ–∫–∏–π —Å—Ç—Ä–µ—Å—Å, –Ω–∏–∑–∫–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ) |
| 2 | Medium | `bg-warning` | –í–∞–∂–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (—Å—Ä–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏) |
| 3+ | Low | `bg-muted` | –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ |

---

## –ü—Ä–∏—á–∏–Ω—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π (Reasons)

| Reason | –û–ø–∏—Å–∞–Ω–∏–µ | Trigger |
|--------|----------|---------|
| `High stress` | –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞ | `stress_level >= 7` |
| `High anxiety` | –í—ã—Å–æ–∫–∞—è —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å | `anxiety_level >= 7` |
| `Low mood` | –ü–ª–æ—Ö–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ | `mood_score <= -2` |
| `Low energy` | –ù–∏–∑–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è | `energy_level <= -2` |
| `Balance` | –î–ª—è –±–∞–ª–∞–Ω—Å–∞ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| `Routine` | –†–µ–≥—É–ª—è—Ä–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ | –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ |

---

## –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

```typescript
const fetchRecommendations = async () => {
  const lang = i18n.language;
  
  const { data, error } = await supabase
    .from('user_recommendations')
    .select(`
      *,
      activity_templates (*)
    `)
    .eq('user_id', user?.id)
    .is('accepted', null)           // –¢–æ–ª—å–∫–æ pending
    .eq('dismissed', false)         // –ù–µ –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–µ
    .order('priority', { ascending: true })
    .order('created_at', { ascending: false });

  // –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π
  const mappedData = data.map(rec => ({
    ...rec,
    activity_templates: {
      name: rec.activity_templates[`name_${lang}`] || rec.activity_templates.name_en,
      description: rec.activity_templates[`description_${lang}`] || rec.activity_templates.description_en,
      // ...–æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
    }
  }));

  setRecommendations(mappedData);
  setHasHighPriority(mappedData.some(r => r.priority === 1));
};
```

---

## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π (Edge Function)

```typescript
// supabase/functions/generate-recommendations/index.ts
export default async function handler(req: Request) {
  const user = await getUser(req);
  
  // 1. –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —Ç—Ä–µ–∫–µ—Ä–∞
  const { data: entries } = await supabase
    .from('tracker_entries')
    .select('*')
    .eq('user_id', user.id)
    .order('created_at', { ascending: false })
    .limit(10);
  
  // 2. –ê–Ω–∞–ª–∏–∑ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
  const avgStress = average(entries.map(e => e.stress_level));
  const avgAnxiety = average(entries.map(e => e.anxiety_level));
  const avgMood = average(entries.map(e => e.mood_score));
  const avgEnergy = average(entries.map(e => e.energy_level));
  
  // 3. –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞
  const { data: rules } = await supabase
    .from('recommendation_rules')
    .select('*')
    .eq('enabled', true);
  
  // 4. –°–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
  const recommendations = [];
  
  for (const rule of rules) {
    if (matchCondition(rule.trigger_condition, { avgStress, avgAnxiety, avgMood, avgEnergy })) {
      for (const templateId of rule.activity_template_ids) {
        recommendations.push({
          user_id: user.id,
          activity_template_id: templateId,
          reason: rule.trigger_condition.reason || 'Balance',
          priority: rule.priority,
        });
      }
    }
  }
  
  // 5. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∏ –≤—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ
  await supabase
    .from('user_recommendations')
    .delete()
    .eq('user_id', user.id)
    .is('accepted', null);
  
  await supabase
    .from('user_recommendations')
    .insert(recommendations);
  
  return new Response(JSON.stringify({ success: true }));
}
```

---

## –î–µ–π—Å—Ç–≤–∏—è —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏

### –î–æ–±–∞–≤–∏—Ç—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è

```typescript
const handleAddToToday = async (rec: Recommendation) => {
  const today = getLocalDateString();
  const now = new Date();
  const startTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;

  // 1. –°–æ–∑–¥–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
  await supabase.from('activities').insert([{
    user_id: user?.id,
    title: rec.activity_templates.name,
    category: rec.activity_templates.category,
    impact_type: rec.activity_templates.impact_type,
    date: today,
    start_time: startTime,
    duration_minutes: rec.activity_templates.default_duration_minutes,
    status: 'planned',
    template_id: rec.activity_template_id,
  }]);

  // 2. –ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–∏–Ω—è—Ç—É—é
  await supabase
    .from('user_recommendations')
    .update({ accepted: true })
    .eq('id', rec.id);

  fetchRecommendations();
};
```

### –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å (–ø–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å)

```typescript
const handleSchedule = async (rec: Recommendation) => {
  // 1. –ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–∏–Ω—è—Ç—É—é
  await supabase
    .from('user_recommendations')
    .update({ accepted: true })
    .eq('id', rec.id);

  // 2. –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º —à–∞–±–ª–æ–Ω–æ–º
  navigate('/calendar', { 
    state: { templateId: rec.activity_template_id } 
  });
};
```

### –û—Ç–∫–ª–æ–Ω–∏—Ç—å

```typescript
const handleDismiss = async (recId: string) => {
  await supabase
    .from('user_recommendations')
    .update({ dismissed: true })
    .eq('id', recId);

  setRecommendations(prev => prev.filter(r => r.id !== recId));
};
```

---

## –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É

```typescript
const groupedRecs = {
  high: recommendations.filter(r => r.priority === 1),
  medium: recommendations.filter(r => r.priority === 2),
  low: recommendations.filter(r => r.priority >= 3),
};
```

---

## –¶–≤–µ—Ç–∞ —Ç–∏–ø–æ–≤ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è

```typescript
const getImpactColor = (impact: string) => {
  switch (impact) {
    case 'restoring': return 'text-green-600 dark:text-green-400';
    case 'depleting': return 'text-red-600 dark:text-red-400';
    case 'neutral': return 'text-orange-600 dark:text-orange-400';
    case 'mixed': return 'text-blue-600 dark:text-blue-400';
    default: return 'text-muted-foreground';
  }
};
```

---

## –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                                  ‚îÇ
‚îÇ                           ‚ú®                                     ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ                    –í—Å—ë –æ—Ç–ª–∏—á–Ω–æ!                                 ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ         –ù–µ—Ç –Ω–æ–≤—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ                     ‚îÇ
‚îÇ         –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏                     ‚îÇ
‚îÇ         –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.                           ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ              [üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏]                        ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Dashboard

–ù–∞ Dashboard –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è `InsightsPreview` ‚Äî –ø—Ä–µ–≤—å—é —Ç–æ–ø-1 —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```typescript
// components/dashboard/InsightsPreview.tsx
const fetchRecommendations = async () => {
  const { data } = await supabase
    .from('user_recommendations')
    .select(`*, activity_templates (name, emoji)`)
    .eq('user_id', user?.id)
    .is('accepted', null)
    .eq('dismissed', false)
    .order('priority', { ascending: true })
    .limit(1);

  setRecommendationCount(data?.length || 0);
  setTopRecommendation(data?.[0] || null);
};
```
